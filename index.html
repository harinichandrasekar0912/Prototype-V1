<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Architectural Assistant Prototype V1</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }
    .section {
      margin-bottom: 30px;
    }
    textarea, input {
      width: 100%;
      padding: 8px;
      margin: 5px 0;
    }
    svg {
      border: 1px solid #ccc;
      margin-top: 20px;
      background-color: #f9f9f9;
      max-width: 100%;
      height: auto;
      display: block;
    }
    button {
      padding: 10px 15px;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <h1>Prototype V1 – Interactive Architectural Assistant</h1>

  <!-- STEP 1: SITE + CONTEXT -->
  <div class="section" id="step1">
    <h2>Step 1: Site + Context Input</h2>

    <label>Site Boundary Coordinates (e.g., (0,0,0);(21,0,0);(21,25,0);(0,25,0))</label>
    <textarea id="siteCoords"></textarea>

    <label>Tree Data – (x,y,0,radius,height); separate multiple trees with semicolon</label>
    <textarea id="treeData"></textarea>

    <label>Context Buildings – Enter building footprints like:<br>
    ((x1,y1,z1);(x2,y2,z2);(x3,y3,z3));((x4,y4,z4);(x5,y5,z5);(x6,y6,z6))</label>
    <textarea id="contextData"></textarea>

    <label>Road Side and Width – Enter boundary edge (x1,y1,0);(x2,y2,0) and road width</label>
    <textarea id="roadEdge"></textarea>
    <input id="roadWidth" placeholder="Enter road width (e.g., 6)" />

    <button onclick="renderStep1()">Render Step 1</button>
    <button onclick="goToStep2()">Proceed to Step 2</button>

    <svg id="canvas" preserveAspectRatio="xMidYMid meet" width="100%" height="auto" style="border:1px dashed #ccc;"></svg>
  </div>

  <script>
    function parseCoords(str) {
      return str.split(";").map(s => s.replace(/[()]/g, "").split(",").map(Number));
    }

    function renderStep1() {
      const svg = document.getElementById("canvas");
      svg.innerHTML = "";

      const scale = 10;
      const siteRaw = document.getElementById("siteCoords").value.trim();
      const sitePoints = siteRaw.split(";").map(pt => {
        const [x, y] = pt.replace(/[()]/g, "").split(",").map(Number);
        return { x, y };
      });

      if (sitePoints.length < 3) return;

      const allX = sitePoints.map(p => p.x);
      const allY = sitePoints.map(p => p.y);
      const minX = Math.min(...allX);
      const maxX = Math.max(...allX);
      const minY = Math.min(...allY);
      const maxY = Math.max(...allY);

      const padding = 50;
      const bboxWidth = (maxX - minX) * scale + 2 * padding;
      const bboxHeight = (maxY - minY) * scale + 2 * padding;
      const offsetX = padding - minX * scale;
      const offsetY = padding + maxY * scale; // invert Y

      svg.setAttribute("viewBox", `0 0 ${bboxWidth} ${bboxHeight}`);
      svg.setAttribute("width", "100%");
      svg.setAttribute("height", "auto");
      svg.setAttribute("preserveAspectRatio", "xMidYMid meet");

      // GRID BACKGROUND
      const gridSpacing = scale;
      for (let x = 0; x < bboxWidth; x += gridSpacing) {
        const line = document.createElementNS("http://www.w3.org/2000/svg", "line");
        line.setAttribute("x1", x);
        line.setAttribute("y1", 0);
        line.setAttribute("x2", x);
        line.setAttribute("y2", bboxHeight);
        line.setAttribute("stroke", "#eee");
        line.setAttribute("stroke-width", 0.5);
        svg.appendChild(line);
      }
      for (let y = 0; y < bboxHeight; y += gridSpacing) {
        const line = document.createElementNS("http://www.w3.org/2000/svg", "line");
        line.setAttribute("x1", 0);
        line.setAttribute("y1", y);
        line.setAttribute("x2", bboxWidth);
        line.setAttribute("y2", y);
        line.setAttribute("stroke", "#eee");
        line.setAttribute("stroke-width", 0.5);
        svg.appendChild(line);
      }

      // SITE BOUNDARY (transparent fill, black stroke)
      const polygon = document.createElementNS("http://www.w3.org/2000/svg", "polygon");
      const pointStr = sitePoints.map(p => `${p.x * scale + offsetX},${offsetY - p.y * scale}`).join(" ");
      polygon.setAttribute("points", pointStr);
      polygon.setAttribute("fill", "transparent");
      polygon.setAttribute("stroke", "black");
      polygon.setAttribute("stroke-width", 2);
      svg.appendChild(polygon);

      // TREES
      const trees = document.getElementById("treeData").value.trim();
      if (trees) {
        trees.split(";").forEach(t => {
          const [x, y, , r] = t.replace(/[()]/g, "").split(",").map(Number);
          const circle = document.createElementNS("http://www.w3.org/2000/svg", "circle");
          circle.setAttribute("cx", x * scale + offsetX);
          circle.setAttribute("cy", offsetY - y * scale);
          circle.setAttribute("r", r * scale);
          circle.setAttribute("fill", "green");
          circle.setAttribute("fill-opacity", "0.25");
          svg.appendChild(circle);
        });
      }

      // CONTEXT BUILDINGS (draw as rectangles)
      const buildingRaw = document.getElementById("contextData").value.trim();
      const buildings = buildingRaw.match(/\(\((.*?)\)\)/g);
      if (buildings) {
        buildings.forEach(group => {
          const vertexStr = group.replace(/\(|\)/g, "");
          const vertices = vertexStr.split(";").map(pt => {
            const [x, y] = pt.trim().split(",").map(Number);
            return { x, y };
          });

          if (vertices.length >= 2) {
            const minX = Math.min(...vertices.map(v => v.x));
            const minY = Math.min(...vertices.map(v => v.y));
            const maxX = Math.max(...vertices.map(v => v.x));
            const maxY = Math.max(...vertices.map(v => v.y));

            const rect = document.createElementNS("http://www.w3.org/2000/svg", "rect");
            rect.setAttribute("x", minX * scale + offsetX);
            rect.setAttribute("y", offsetY - maxY * scale);
            rect.setAttribute("width", (maxX - minX) * scale);
            rect.setAttribute("height", (maxY - minY) * scale);
            rect.setAttribute("fill", "#bbb");
            rect.setAttribute("stroke", "#333");
            rect.setAttribute("stroke-width", 1);
            rect.setAttribute("opacity", 0.6);
            svg.appendChild(rect);
          }
        });
      }

      // ROAD LINE
      const roadEdge = document.getElementById("roadEdge").value.trim();
      const roadWidth = parseFloat(document.getElementById("roadWidth").value.trim());
      if (roadEdge && !isNaN(roadWidth)) {
        const [p1, p2] = roadEdge.split(";").map(p => {
          const [x, y] = p.replace(/[()]/g, "").split(",").map(Number);
          return { x, y };
        });

        const road = document.createElementNS("http://www.w3.org/2000/svg", "line");
        road.setAttribute("x1", p1.x * scale + offsetX);
        road.setAttribute("y1", offsetY - p1.y * scale);
        road.setAttribute("x2", p2.x * scale + offsetX);
        road.setAttribute("y2", offsetY - p2.y * scale);
        road.setAttribute("stroke", "#666");
        road.setAttribute("stroke-width", roadWidth * scale);
        road.setAttribute("opacity", 0.5);
        svg.appendChild(road);
      }
    }

    function goToStep2() {
      document.getElementById("step1").style.display = "none";
      document.getElementById("step2").style.display = "block";
    }
  </script>

  <!-- STEP 2: GROUND ZONING -->
  <div class="section" id="step2" style="display:none;">
    <h2>Step 2: Ground Zoning & Footprint Analysis</h2>

    <div style="margin-bottom: 15px;">
      <label for="siteWidth">Site Width (m):</label>
      <input type="number" id="siteWidth" value="30" />

      <label for="siteDepth" style="margin-left: 10px;">Site Depth (m):</label>
      <input type="number" id="siteDepth" value="40" />

      <label for="setbackFront" style="margin-left: 10px;">Front Setback (m):</label>
      <input type="number" id="setbackFront" value="3" />

      <label for="setbackRear" style="margin-left: 10px;">Rear Setback (m):</label>
      <input type="number" id="setbackRear" value="3" />

      <label for="setbackSide" style="margin-left: 10px;">Side Setback (m):</label>
      <input type="number" id="setbackSide" value="1.5" />

      <button onclick="generateZoning()">Generate Zoning</button>
    </div>

    <svg id="zoningDiagram" style="border: 1px solid #aaa;"></svg>
    <button onclick="goToStep3()">Proceed to Step 3</button>
  </div>

    <!-- STEP 3: AREA STATEMENT -->
  <div class="section" id="step3" style="display:none;">
    <h2>Step 3: Area Statement</h2>

    <button onclick="generateAreaStatement()">Generate Area Statement</button>

    <div id="areaStatementOutput" style="margin-top: 15px; border: 1px solid #ddd; padding: 10px; background-color: #f9f9f9;">
      <strong>Area Statement will appear here.</strong>
    </div>

    <button onclick="goToStep4()">Proceed to Step 4</button>
  </div>

  <!-- STEP 4: BUBBLE DIAGRAM -->
  <div class="section" id="step4" style="display:none;">
    <h2>Step 4: Bubble Diagram</h2>
    <p>[UI and logic for Step 4 will go here]</p>
    <button onclick="goToStep5()">Proceed to Step 5</button>
  </div>

  <!-- STEP 5: FINAL PLAN -->
  <div class="section" id="step5" style="display:none;">
    <h2>Step 5: Final Plan</h2>
    <p>[UI and logic for Step 5 will go here]</p>
  </div>

  <script>
    function generateZoning() {
      const svg = document.getElementById("zoningDiagram");
      svg.innerHTML = "";

      const scale = 10;
      const siteWidth = parseFloat(document.getElementById("siteWidth").value);
      const siteDepth = parseFloat(document.getElementById("siteDepth").value);
      const setbackFront = parseFloat(document.getElementById("setbackFront").value);
      const setbackRear = parseFloat(document.getElementById("setbackRear").value);
      const setbackSide = parseFloat(document.getElementById("setbackSide").value);

      const margin = 50;
      const totalWidth = siteWidth * scale + 2 * margin;
      const totalHeight = siteDepth * scale + 2 * margin;
      const siteX = margin;
      const siteY = margin;

      svg.setAttribute("viewBox", `0 0 ${totalWidth} ${totalHeight}`);
      svg.setAttribute("preserveAspectRatio", "xMidYMid meet");
      svg.setAttribute("width", "100%");
      svg.setAttribute("height", "auto");

      // Site boundary
      const siteRect = document.createElementNS("http://www.w3.org/2000/svg", "rect");
      siteRect.setAttribute("x", siteX);
      siteRect.setAttribute("y", siteY);
      siteRect.setAttribute("width", siteWidth * scale);
      siteRect.setAttribute("height", siteDepth * scale);
      siteRect.setAttribute("fill", "#f0f0f0");
      siteRect.setAttribute("stroke", "#000");
      siteRect.setAttribute("stroke-width", "2");
      svg.appendChild(siteRect);

      // Buildable area
      const buildableX = siteX + setbackSide * scale;
      const buildableY = siteY + setbackFront * scale;
      const buildableWidth = (siteWidth - 2 * setbackSide) * scale;
      const buildableHeight = (siteDepth - setbackFront - setbackRear) * scale;

      const buildableRect = document.createElementNS("http://www.w3.org/2000/svg", "rect");
      buildableRect.setAttribute("x", buildableX);
      buildableRect.setAttribute("y", buildableY);
      buildableRect.setAttribute("width", buildableWidth);
      buildableRect.setAttribute("height", buildableHeight);
      buildableRect.setAttribute("fill", "#a3d3ff");
      buildableRect.setAttribute("stroke", "#0077cc");
      buildableRect.setAttribute("stroke-width", "2");
      svg.appendChild(buildableRect);

      // Label
      const text = document.createElementNS("http://www.w3.org/2000/svg", "text");
      text.setAttribute("x", siteX + 5);
      text.setAttribute("y", siteY - 10);
      text.textContent = "Site & Buildable Footprint";
      text.setAttribute("font-size", "14px");
      text.setAttribute("fill", "#333");
      svg.appendChild(text);
    }

    function generateAreaStatement() {
      const siteWidth = parseFloat(document.getElementById("siteWidth").value);
      const siteDepth = parseFloat(document.getElementById("siteDepth").value);
      const setbackFront = parseFloat(document.getElementById("setbackFront").value);
      const setbackRear = parseFloat(document.getElementById("setbackRear").value);
      const setbackSide = parseFloat(document.getElementById("setbackSide").value);

      const siteArea = siteWidth * siteDepth;
      const buildableWidth = siteWidth - (2 * setbackSide);
      const buildableDepth = siteDepth - (setbackFront + setbackRear);
      const buildableArea = buildableWidth * buildableDepth;

      const FSI = 1.5;
      const builtUpArea = siteArea * FSI;

      const outputHTML = `
        <h3>Area Statement</h3>
        <ul>
          <li><strong>Site Area:</strong> ${siteArea.toFixed(2)} sq.m</li>
          <li><strong>Buildable Area (after setbacks):</strong> ${buildableArea.toFixed(2)} sq.m</li>
          <li><strong>Assumed FSI:</strong> ${FSI}</li>
          <li><strong>Permissible Built-up Area:</strong> ${builtUpArea.toFixed(2)} sq.m</li>
          <li><strong>Setbacks Applied:</strong> Front = ${setbackFront} m, Rear = ${setbackRear} m, Side = ${setbackSide} m (both sides)</li>
        </ul>
      `;
      document.getElementById("areaStatementOutput").innerHTML = outputHTML;
    }

    function goToStep3() {
      document.getElementById("step2").style.display = "none";
      document.getElementById("step3").style.display = "block";
    }

    function goToStep4() {
      document.getElementById("step3").style.display = "none";
      document.getElementById("step4").style.display = "block";
    }

    function goToStep5() {
      document.getElementById("step4").style.display = "none";
      document.getElementById("step5").style.display = "block";
    }
  </script>
</body>
</html>
